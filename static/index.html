<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI Radiostation — Podcast Generator</title>
    <style>
      body { font-family: system-ui, -apple-system, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
      textarea { width: 100%; min-height: 140px; }
      button { padding: 8px 12px; margin-top: 8px; }
      audio { display: block; margin-top: 12px; }
    </style>
  </head>
  <body>
    <h1>AI Radiostation</h1>
    <p>Fill the fields below to generate a mixed episode (MP3) from topics and host personas.</p>

    <h3>Topics</h3>
    <p>One topic per line:</p>
    <textarea id="topics" placeholder="AI ethics\nIndie film picks">AI ethics
Indie film picks</textarea>

    <h3>Hosts</h3>
    <p>One host per line in the format: <code>Name|Persona</code> (e.g. Maya|sarcastic film geek)</p>
    <textarea id="hosts" placeholder="Maya|sarcastic film geek\nRowan|calm tech nerd">Maya|sarcastic film geek
Rowan|calm tech nerd</textarea>

    <h3>Segment Durations (seconds)</h3>
    <div>
      <label>Topic: <input type="number" id="dur_topic" value="120" /></label>
      <label>Banter: <input type="number" id="dur_banter" value="30" /></label>
      <label>Cold open: <input type="number" id="dur_cold" value="10" /></label>
      <label>Ad: <input type="number" id="dur_ad" value="20" /></label>
      <label>Outro: <input type="number" id="dur_outro" value="20" /></label>
    </div>

    <h3>Station Style</h3>
    <input id="style" placeholder="e.g. chill night radio" value="chill night radio" />

    <br />
    <button id="create">Create Episode</button>

    <div id="result"></div>

    <script>
      function parseHosts(text) {
        return text.split('\n').map(line => line.trim()).filter(Boolean).map(line => {
          const parts = line.split('|');
          return { name: parts[0].trim(), persona: (parts[1]||'').trim() };
        });
      }

      document.getElementById('create').addEventListener('click', async () => {
        const topicsText = document.getElementById('topics').value;
        const hostsText = document.getElementById('hosts').value;
        const topics = topicsText.split('\n').map(s => s.trim()).filter(Boolean);
        const hosts = parseHosts(hostsText);
        const durations = {
          topic: parseInt(document.getElementById('dur_topic').value, 10) || 120,
          banter: parseInt(document.getElementById('dur_banter').value, 10) || 30,
          cold_open: parseInt(document.getElementById('dur_cold').value, 10) || 10,
          ad: parseInt(document.getElementById('dur_ad').value, 10) || 20,
          outro: parseInt(document.getElementById('dur_outro').value, 10) || 20,
        };
        const style = document.getElementById('style').value || '';

        if (!topics.length || !hosts.length) {
          document.getElementById('result').innerText = 'Please enter at least one topic and one host.';
          return;
        }

        const payload = { topics, hosts, durations, style };
        document.getElementById('result').innerText = 'Generating episode — this may take a minute...';

        try {
          const res = await fetch('/create_episode', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });
          const body = await res.json();
          if (!res.ok) throw new Error(body.detail || JSON.stringify(body));
          const audioUrl = body.audio_url;
          document.getElementById('result').innerHTML = `Episode ready: <a href="${audioUrl}" target="_blank">Download MP3</a><br/><audio controls src="${audioUrl}"></audio>`;
        } catch (err) {
          document.getElementById('result').innerText = 'Error: ' + err.message;
        }
      });
    </script>
  </body>
</html>
